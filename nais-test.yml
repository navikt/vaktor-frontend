apiVersion: nais.io/v1alpha1
kind: Application
metadata:
    name: vaktor
    namespace: navdig
    labels:
        team: navdig
spec:
    accessPolicy:
        inbound:
            rules:
                - application: vaktor-plan-api
                - application: ida # Allow IDA users to test this proxy in dev.
                  namespace: traktor
                  cluster: prod-fss #IDA users come from the production environment.
        outbound:
            rules:
                - application: vaktor-plan-api
                - application: fullmaktsregister-external-proxy
                  namespace: team-nof
                  cluster: dev-gcp
    image: {{ image }}
    port: 3000
    ingresses:
        - https://vaktor.intern.dev.nav.no
    env:
        - name: NPM_CONFIG_CACHE
          value: /tmp
        - name: BACKEND_URL
          value: http://vaktor-plan-api
    replicas:
        min: 1
        max: 1
    azure:
        application:
            enabled: true
            tenant: trygdeetaten.no
            allowAllUsers: true
            claims:
                extra:
                    - "NAVident"
                    - "azp_name"
            singlePageApplication: false
        sidecar:
            enabled: true
            # everything below is optional, defaults shown
            autoLogin: true
            errorPath: ""
